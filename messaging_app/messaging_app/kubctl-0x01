#!/bin/bash

# Step 1: Scale the Django app deployment to 3 replicas
echo "Scaling Django app deployment to 3 replicas..."
kubectl scale deployment messaging-app-deployment --replicas=3

# Step 2: Verify that multiple pods are running
echo "Checking pods..."
kubectl get pods -l app=messaging-app

# Step 3: Run load testing with wrk (assumes port-forwarding on 8000)
echo "Starting load test with wrk..."
echo "Make sure you have port-forwarded: kubectl port-forward svc/messaging-app-service 8000:8000"
wrk -t4 -c100 -d30s http://127.0.0.1:8000/

# Step 4: Monitor resource usage
echo "Monitoring resource usage..."
kubectl top pods
